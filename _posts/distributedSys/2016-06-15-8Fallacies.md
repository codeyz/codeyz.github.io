---
title: 分布式计算的八大谬误
layout: post
category : [distributed system]
tag : []
---
{% include JB/setup %}

在分布式系统领域，有著名的**分布式计算的八大谬误**，列举了八个分布式系统设计者在系统设计伊始做的假设，从长期来看，这些假设都是错误的而且最终会导致非常严重的故障。 这八大谬误的作者是[Peter Deutsch](https://en.wikipedia.org/wiki/L_Peter_Deutsch#cite_note-3)。在深入正题之前，我们先来聊聊这位大哥。也许你不知道这哥们，但你应该知道（写过论文的一定知道）Ghostscript，一个开源的PostScript<->PDF的转化器，Peter就是它的作者；或者你知道Smalltalk，作为“面向对象编程之母”，它对Object-C、Java、还有那本四人帮的设计模式等都有非常大的影响，而Peter是核心开发者。Peter是个计算机天才，在17岁到21岁期间，就写出了Basic PDP-1 Lisp。在27岁时拿到了UC伯克利的CS Ph.D。作为计算机领域的先驱者，他有着非常多的建树。然而，最让人惊叹的是，在他的花甲之年，老头跑去斯坦福旁听了音乐课，又顺便拿了加州州立大学的Master Of Arts。然后众所周知，在他现在的[自我介绍](http://www.major2nd.com/users/lpd/)上，他的职业一栏写的是作曲家。


<h3>The network is reliable</h3>
第一个谬误，网络是可靠的。从物理层来看，交换机、路由、甚至是一根网线都不是完全正常的。交换机有MTBF（Mean Time Between Failure），也就是说，从长远来看，它肯定会出故障；你以为网线是安全的，然而现实是也许某一天它就突然被网管错拔了。总之，硬件无法让人高枕无忧。因此，Google File System在设计时，就希望通过软件来解决硬件问题：

> Component failures are the norm rather than the exception.

既然网络是不可靠的，那我们做系统设计时，应该要注意两点：

1. 基础设施层，我们应该在资金和设备的冗余与故障风险之间做一个平衡。
2. 软件层。我们在收发消息时，可以采用消息队列（如RabbitMQ）来保证消息的正常收发；如果不用消息队列，那么开发人员需要保证不丢包，消息到达的顺序等等。

<h3>Latency is zero</h3>

延迟是指消息发出者发送消息到接收者接收到消息的时间间隔。如果在局域网内，也许你会觉得你的延迟很低；而一旦到了广域网，情况可能就会大为改变。中国和美国的距离大概为11000公里，如果光纤按最理想的状态——光速计算，也需要37毫秒，更何况在复杂的网络状况中，需要经过各种路由、交换机等等。所以在网络传输中，零延迟是不可能的。既然如此，我们需要提高单次网络访问的吞吐量来提高效率。

<h3>Bandwith is infinite</h3>

相对于其它谬误，“带宽是无限”算不上特别荒谬。但带宽增加了，我们想要传输的数据也一样在增加；另外，在低带宽下，包丢失是一个问题。网络传输并非完全精确的，所以都会有包重传的问题。因此，我们在做设计以及测试时，带宽因此需要被考虑。

<h3>The Network is secure</h3>
这条谬误对现时也非常适用，频繁的脱库事件表明，网络不可能是安全的。我们一定要把“网络不安全”这一问题列入软件设计的考虑范围之内。

<h3>Topology doesn't change</h3>

事实上，"Topology change constantly"才是正确的。网络设备的变更、网络拓扑结构的变化可能是你无法控制的，比如现在移动设备的盛行，你的网络随时都有设备进出。这条谬误给我们的指导是：

1. 我们的软件不应该依赖于某一个特定的设备。
2. 设计软件时，抽象出网络层的物理结构。

<h3>There is one administrator</h3>

在公司里，不同的产品可能会有不同的管理员，每个管理员的操作准则和事情不一样，他们也并不会受你控制。开发人员和他们的职业不一样，但要和他们合作，我们至少在设计软件时要考虑到，是不是应该提供一个管理工具供他们使用。他们在工作中，可能会限制你的想法（比如，他们管理着端口开放、数据库权限等等），而作为开发人员，有必要帮助他们管理你写的应用。

<h3>Transport cost is zero</h3>

这个是不可能的。运行你的软件，你需要计算资源、存储资源，硬件设备等等。我们能做的，只是减少代价，提高效率。

<h3>The network is homogeneous</h3>

同质网络是指那些由相似的网络配置和协议构成的网络。最简单的例子是，由MS Server通过TCP/IP互联的网络。事实上，我们的网络中，存在着各种不同的设备，有MS Server、Linux，还有各种移动设备，在软件层，网络中也可能存在着不同的网络协议。同质的网络几乎是不可能的。


<h3>文献</h3>
1. [The Eight Fallacies of Distributed Computing](https://blogs.oracle.com/jag/resource/Fallacies.html)
